<h1 name="content" align="center"><a href=""><img src="https://github.com/user-attachments/assets/e080adec-6af7-4bd2-b232-d43cb37024ac" width="20" height="20"/></a> MSSQL Вариант 6</h1>

<p align="center">
  <a href="#-lab1"><img alt="lab1" src="https://img.shields.io/badge/Lab1-blue"></a> 
  <a href="#-lab2"><img alt="lab2" src="https://img.shields.io/badge/Lab2-red"></a>
  <a href="#-lab3"><img alt="lab3" src="https://img.shields.io/badge/Lab3-green"></a>
  <a href="#-lab4"><img alt="lab4" src="https://img.shields.io/badge/Lab4-yellow"></a>
  <a href="#-lab5"><img alt="lab5" src="https://img.shields.io/badge/Lab5-gray"></a>
  <a href="#-lab6"><img alt="lab6" src="https://img.shields.io/badge/Lab6-orange"></a> 
  <a href="#-lab7"><img alt="lab7" src="https://img.shields.io/badge/Lab7-brown"></a>
  <a href="#-lab8"><img alt="lab8" src="https://img.shields.io/badge/Lab8-purple"></a>
  <a href="#-lab9"><img alt="lab9" src="https://img.shields.io/badge/Lab9-violet"></a> 
</p>

# <img src="https://github.com/user-attachments/assets/e080adec-6af7-4bd2-b232-d43cb37024ac" width="20" height="20"/> Lab1
[Назад](#content)
<h4 align="left">
  <a href="#client"></a>
Разработать ER-модель данной предметной области: выделить сущности, их атрибуты, связи между сущностями. 
Для каждой сущности указать ее имя, атрибут (или набор атрибутов), являющийся первичным ключом, список остальных атрибутов.
Для каждого атрибута указать его тип, ограничения, может ли он быть пустым, является ли он первичным ключом.
Для каждой связи между сущностями указать: 
- тип связи (1:1, 1:M, M:N)
- обязательность

ER-модель д.б. представлена в виде ER-диаграммы (картинка)

По имеющейся ER-модели создать реляционную модель данных и отобразить ее в виде списка сущностей с их атрибутами и типами атрибутов,  для атрибутов указать, явл. ли он первичным или внешним ключом 
</h4>
Предметная область:
Работа книжного магазина
Описание Предметной области (ВНИМАНИЕ: список сущностей и их атрибутов определен ПРИМЕРНО, окончательное кол-во сущностей и их атрибутов нужно определить, исходя из раздела «Реализовать»)

Книги: шифр книги, список авторов, название, жанр.
Тиражи книг: Дата поступления тиража книги, издательство, закупочная цена тиража, число поступивших экземпляров тиража, число еще не проданных экземпляров тиража, цена продажи.

Реализовать:
- Поиск книги по шифру, автору или названию;
- Определение самой продаваемой книги – с наибольшим количеством проданных экземпляров по всем тиражам;
- Определение самой непродаваемой книги;
- Определение чистой прибыли с каждого тиража заданной книги и по всем тиражам вместе;
- Определение убыточных тиражей (общая цена всех проданных книг этого тиража не превысила закупочную цену);
- Печать списка книг по нужной теме.

Примечание: тираж – количество экземпляров одной книги, выпущенной издательством в конкретный срок. Например, одна и та же книга м.б. выпущена разными издательствами и в разные даты – это будут разные тиражи.


![image](/sources/er_diag.png)

 По имеющейся ER-модели создал реляционную модель данных и отобразил ее в виде списка сущностей с их атрибутами и типами атрибутов:

![image](/sources/relation_model_diag.png)


# <img src="https://github.com/user-attachments/assets/e080adec-6af7-4bd2-b232-d43cb37024ac" width="20" height="20"/> Lab2
[Назад](#content)
<h4>
В соответствии с реляционной моделью данных, разработанной в Лаб.№1, создать реляционную БД на учебном сервере БД :
- создать таблицы, определить первичные ключи и иные ограничения
- определить связи между таблицами
- создать диаграмму
- заполнить все таблицы адекватной информацией (не меньше 10 записей в таблицах, наличие примеров для связей типа 1:M )
</h4>

Создал на локальном сервере БД bookshop через SQL Server Managment Studio 21.

```tsql
use boolshop
```

Выполнил следующие запросы для создания таблиц в БД:

```tsql
create table [Автор] (
	id int Not Null Primary Key,
	[имя] nvarchar(255) Not Null
);

create table [Жанр] (
	id int Not Null Primary Key,
	[название] nvarchar(255) Not Null
);

create table [Тема] (
	id int Not Null Primary Key,
	[название] nvarchar(255) Not Null
);

create table [Книга образец] (
	id int Not Null Primary Key,
	[название] nvarchar(255) Not Null
);

create table [Издательство] (
	id int Not Null Primary Key,
	[название] nvarchar(255) Not Null,
	[телефон] nvarchar(11),
	[адрес] nvarchar(255)
);

create table [Покупатель] (
	id int Not Null Primary Key,
	[ФИО] nvarchar(255) Not Null,
	[адрес] nvarchar(255)
);
```

Зависимые от FK таблицы:

```tsql
create table [Заказ] (
	id int Not Null Primary Key,
	[статус] int Not Null Default(0),
	[дата] date Not Null,
	[id_покупателя] int,
	FOREIGN KEY ([id_покупателя]) REFERENCES [Покупатель]([id]) ON DELETE CASCADE,
	CHECK ([статус] > -1 AND [статус] < 3)
);

create table [Тираж книги] (
	id int Not Null Primary Key,
	[дата поступления] date Not Null,
	[дата] date Not Null,
	[цена продажи] decimal Not Null,
	[число экземпляров] int Not Null,
	[закупочная цена] decimal Not Null,
	[id_издательства] int Not Null,
	FOREIGN KEY ([id_издательства]) REFERENCES [Издательство]([id]) ON DELETE CASCADE,
	CHECK ([число экземпляров] >= 0 and [закупочная цена] >= 0 and [цена продажи] >= 0)
);

create table [Книга экземпляр] (
	[шифр] int Not Null Primary Key,
	[id_тиража_книги] int Not Null,
	[id_образца] int Not Null,
	[id_заказа] int Not Null,
	FOREIGN KEY ([id_тиража_книги]) REFERENCES [Тираж книги]([id]) ON DELETE CASCADE,
	FOREIGN KEY ([id_образца]) REFERENCES [Книга образец]([id]) ON DELETE CASCADE,
	FOREIGN KEY ([id_заказа]) REFERENCES [Заказ]([id]) ON DELETE CASCADE
);

CREATE TABLE [Книга_Автор] (
    [id_книги] int Not Null,
    [id_автора] int Not Null,
    Primary Key ([id_автора], [id_книги]),
    Foreign Key ([id_автора]) References [Автор]([id]),
    Foreign Key ([id_книги]) References [Книга_образец]([id])
);

create table [Книга_Жанр] (
	[id_книги] int Not Null,
	[id_жанра] int Not Null,
	Primary Key ([id_книги], [id_жанра]),
	Foreign Key ([id_книги]) references [Книга_образец]([id]),
	Foreign Key ([id_жанра]) references [Жанр]([id])
);

create table [Книга_Тема] (
	[id_книги] int Not Null,
	[id_темы] int Not Null,
	Primary Key ([id_книги], [id_темы]),
	Foreign Key ([id_книги]) references [Книга_образец]([id]),
	Foreign Key ([id_темы]) references [Тема]([id])
)
```
Далее выполнил запросы на добавление 10 записей в каждую таблицу:

```tsql
INSERT INTO [Автор] (id, имя) VALUES
(1, N'Лев Толстой'),
(2, N'Фёдор Достоевский'),
(3, N'Александр Пушкин'),
(4, N'Антон Чехов'),
(5, N'Михаил Булгаков'),
(6, N'Николай Гоголь'),
(7, N'Иван Тургенев'),
(8, N'Владимир Набоков'),
(9, N'Сергей Есенин'),
(10, N'Марина Цветаева');

INSERT INTO [Жанр] (id, название) VALUES
(1, N'Роман'),
(2, N'Поэзия'),
(3, N'Драма'),
(4, N'Фантастика'),
(5, N'Детектив'),
(6, N'Исторический'),
(7, N'Философия'),
(8, N'Приключения'),
(9, N'Эссе'),
(10, N'Комедия');

INSERT INTO [Тема] (id, название) VALUES
(1, N'Любовь'),
(2, N'Война'),
(3, N'Природа'),
(4, N'Общество'),
(5, N'Смерть'),
(6, N'Свобода'),
(7, N'Дружба'),
(8, N'Путешествия'),
(9, N'Власть'),
(10, N'Семья');

INSERT INTO [Книга образец] (id, название) VALUES
(1, N'Война и мир'),
(2, N'Преступление и наказание'),
(3, N'Евгений Онегин'),
(4, N'Вишнёвый сад'),
(5, N'Мастер и Маргарита'),
(6, N'Мёртвые души'),
(7, N'Отцы и дети'),
(8, N'Лолита'),
(9, N'Анна Снегина'),
(10, N'Поэмы');

INSERT INTO [Издательство] (id, название, телефон, адрес) VALUES
(1, N'АСТ', '74951234567', N'Москва, ул. Ленина, д.1'),
(2, N'Эксмо', '74959876543', N'Санкт-Петербург, Невский пр., д.10'),
(3, N'Питер', '78121234567', N'Санкт-Петербург, ул. Пушкина, д.5'),
(4, N'Просвещение', '74951230000', N'Москва, ул. Тверская, д.20'),
(5, N'Дрофа', '74951239999', N'Москва, ул. Арбат, д.15'),
(6, N'Альпина', '74951231111', N'Москва, ул. Садовая, д.7'),
(7, N'Вече', '74959870000', N'Санкт-Петербург, ул. Мира, д.3'),
(8, N'КомпасГид', '74951232222', N'Москва, ул. Новая, д.12'),
(9, N'Манн, Иванов и Фербер', '74951233333', N'Москва, ул. Большая, д.8'),
(10, N'Эксмо-Пресс', '74959874444', N'Санкт-Петербург, ул. Ломоносова, д.9');

INSERT INTO [Покупатель] (id, ФИО, адрес) VALUES
(1, N'Иванов Иван Иванович', N'Москва, ул. Ленина, д.1'),
(2, N'Петров Пётр Петрович', N'Санкт-Петербург, Невский пр., д.10'),
(3, N'Сидоров Сидор Сидорович', N'Казань, ул. Пушкина, д.5'),
(4, N'Кузнецова Мария Ивановна', N'Новосибирск, ул. Советская, д.3'),
(5, N'Васильев Алексей Сергеевич', N'Екатеринбург, ул. Ленина, д.7'),
(6, N'Морозова Ольга Викторовна', N'Нижний Новгород, ул. Гагарина, д.12'),
(7, N'Смирнов Дмитрий Алексеевич', N'Челябинск, ул. Ломоносова, д.8'),
(8, N'Попова Елена Николаевна', N'Ростов-на-Дону, ул. Мира, д.15'),
(9, N'Новиков Андрей Павлович', N'Воронеж, ул. Октябрьская, д.20'),
(10, N'Зайцева Наталья Ивановна', N'Пермь, ул. Карла Маркса, д.9');

INSERT INTO [Заказ] (id, статус, дата, id_покупателя) VALUES
(1, 0, '2024-01-10', 1),
(2, 1, '2024-01-15', 2),
(3, 2, '2024-01-20', 3),
(4, 0, '2024-02-01', 4),
(5, 1, '2024-02-05', 5),
(6, 2, '2024-02-10', 6),
(7, 0, '2024-02-15', 7),
(8, 1, '2024-02-20', 8),
(9, 2, '2024-02-25', 9),
(10, 0, '2024-03-01', 10);

INSERT INTO [Тираж книги] (id, [дата поступления], дата, [цена продажи], [число экземпляров], [закупочная цена], id_издательства) VALUES
(1, '2023-12-01', '2023-12-10', 500, 1000, 300, 1),
(2, '2023-11-15', '2023-11-20', 450, 800, 280, 2),
(3, '2024-01-05', '2024-01-10', 600, 1200, 350, 3),
(4, '2023-10-20', '2023-10-25', 550, 900, 320, 4),
(5, '2023-12-15', '2023-12-20', 700, 1100, 400, 5),
(6, '2024-01-10', '2024-01-15', 480, 950, 300, 6),
(7, '2023-11-30', '2023-12-05', 520, 850, 310, 7),
(8, '2024-02-01', '2024-02-05', 530, 1000, 320, 8),
(9, '2024-02-10', '2024-02-15', 490, 900, 290, 9),
(10, '2024-03-01', '2024-03-05', 510, 950, 305, 10);

INSERT INTO [Книга экземпляр] (шифр, id_тиража_книги, id_образца, id_заказа) VALUES
(1001, 1, 1, 1),
(1002, 2, 2, 2),
(1003, 3, 3, 3),
(1004, 4, 4, 4),
(1005, 5, 5, 5),
(1006, 6, 6, 6),
(1007, 7, 7, 7),
(1008, 8, 8, 8),
(1009, 9, 9, 9),
(1010, 10, 10, 10);

INSERT INTO [Книга_Автор] (id_книги, id_автора) VALUES
(1, 1),
(2, 2),
(3, 3),
(4, 4),
(5, 5),
(6, 6),
(7, 7),
(8, 8),
(9, 9),
(10, 10);

INSERT INTO [Книга_Тема] (id_книги, id_темы) VALUES
(1, 2),
(2, 5),
(3, 1),
(4, 4),
(5, 3),
(6, 9),
(7, 6),
(8, 8),
(9, 7),
(10, 10);

INSERT INTO [Книга_Жанр] (id_книги, id_жанра) VALUES
(1, 1),
(2, 1),
(3, 2),
(4, 3),
(5, 1),
(6, 6),
(7, 1),
(8, 4),
(9, 2),
(10, 2);

```
